<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Skin Analysis - Error</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Modal transition styles */
        #errorModal.opacity-0 {
            pointer-events: none;
        }
        #modalContent.scale-95 {
            transform: scale(0.95);
        }
        /* Indeterminate progress bar animation */
        @keyframes progress-bar-indeterminate {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        .progress-bar-inner {
            width: 50%;
            animation: progress-bar-indeterminate 2s ease-in-out infinite;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 flex items-center justify-center min-h-screen p-4">

    <!-- Main container -->
    <div class="w-full max-w-2xl mx-auto bg-white dark:bg-gray-800 rounded-2xl shadow-2xl overflow-hidden">
        <!-- Header -->
        <div class="p-6 sm:p-8">
            <h1 class="text-2xl sm:text-3xl font-bold text-center text-gray-900 dark:text-white">
                AI Skin Analysis
            </h1>
            <p class="text-center text-sm sm:text-base text-gray-500 dark:text-gray-400 mt-2">
                Please upload a clear facial photo to start your skin discovery journey.
            </p>
        </div>
        
        <div id="uploadContainer" class="p-6 sm:p-8 border-t border-gray-200 dark:border-gray-700">
            <!-- Upload Area -->
            <div id="uploadArea" class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl p-6 sm:p-8 text-center cursor-pointer hover:border-blue-500 dark:hover:border-blue-400 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-all">
                <input type="file" id="fileInput" class="hidden" accept="image/*">
                <div class="flex flex-col items-center">
                    <svg class="w-12 h-12 text-gray-400 dark:text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5" />
                    </svg>
                    <p class="mt-4 text-base sm:text-lg font-semibold text-gray-700 dark:text-gray-300">Click here to upload an image</p>
                    <p class="mt-1 text-xs sm:text-sm text-gray-500 dark:text-gray-400">Supports JPG, PNG, WEBP, etc.</p>
                </div>
            </div>

            <!-- Image Preview -->
            <div id="imagePreviewContainer" class="hidden mt-6 text-center">
                <img id="imagePreview" src="#" alt="Image Preview" class="w-48 h-48 sm:w-56 sm:h-56 object-cover mx-auto rounded-lg shadow-md"/>
            </div>

            <!-- Progress Bar -->
            <div id="progressContainer" class="hidden mt-8">
                <p id="progressText" class="text-center text-blue-600 dark:text-blue-400 font-medium mb-2 text-sm sm:text-base"></p>
                <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5 overflow-hidden">
                    <div id="progressBar" class="bg-blue-600 h-2.5 rounded-full progress-bar-inner"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Error Modal -->
    <div id="errorModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50 opacity-0 transition-opacity duration-300 hidden">
        <div id="modalContent" class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-md p-6 relative transform scale-95 transition-transform duration-300 text-center">
            
            <!-- Modal Header -->
            <div class="mb-4">
                <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 dark:bg-red-900/50">
                    <svg class="h-6 w-6 text-red-600 dark:text-red-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                    </svg>
                </div>
                <h3 class="text-lg text-gray-900 dark:text-white mt-4">
                    Detection result error!
                </h3>
                <p class="text-base text-red-600 dark:text-red-500 mt-2 font-bold">
                    Please open this link in your browser.
                </p>
            </div>

            <!-- URL and Copy Button -->
            <div class="mt-4 flex rounded-md shadow-sm">
                <input type="text" id="urlLink" value="https://ai.ruisat.com/" readonly class="flex-1 block w-full rounded-none rounded-l-md bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600 px-3 py-2 text-gray-700 dark:text-gray-200 focus:outline-none">
                <button id="copyButton" type="button" class="relative -ml-px inline-flex items-center space-x-2 rounded-r-md border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700/50 px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 transition-colors">
                    <svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 7.5V6.108c0-1.135.845-2.098 1.976-2.192.373-.03.748-.03 1.125 0 1.131.094 1.976 1.057 1.976 2.192V7.5m-9 3c0-1.135.845-2.098 1.976-2.192a48.424 48.424 0 011.125 0c1.131.094 1.976 1.057 1.976 2.192V18a2.25 2.25 0 002.25 2.25h3.375A2.25 2.25 0 0018 18v-7.5a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 10.5v7.5a2.25 2.25 0 002.25 2.25h.75" />
                    </svg>
                    <span id="copyButtonText">Copy</span>
                </button>
            </div>

            <!-- Close Button -->
            <div class="mt-5 sm:mt-6">
                <button id="closeModalButton" type="button" class="inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600">
                    Close
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- DOM Elements ---
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const imagePreviewContainer = document.getElementById('imagePreviewContainer');
        const imagePreview = document.getElementById('imagePreview');
        const progressContainer = document.getElementById('progressContainer');
        const progressText = document.getElementById('progressText');
        const errorModal = document.getElementById('errorModal');
        const modalContent = document.getElementById('modalContent');
        const closeModalButton = document.getElementById('closeModalButton');
        const copyButton = document.getElementById('copyButton');
        const copyButtonText = document.getElementById('copyButtonText');
        const urlLink = document.getElementById('urlLink');

        // --- Event Listeners ---
        uploadArea.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', handleFileSelect);
        closeModalButton.addEventListener('click', hideModal);
        copyButton.addEventListener('click', copyLink);

        // --- Functions ---

        function showModal() {
            errorModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            setTimeout(() => {
                errorModal.classList.remove('opacity-0');
                modalContent.classList.remove('scale-95');
            }, 10);
        }

        function hideModal() {
            document.body.style.overflow = '';
            errorModal.classList.add('opacity-0');
            modalContent.classList.add('scale-95');
            setTimeout(() => {
                errorModal.classList.add('hidden');
                resetUI(); // Reset the UI after modal is hidden
            }, 300);
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    imagePreview.src = e.target.result;
                };
                reader.readAsDataURL(file);
                
                imagePreviewContainer.classList.remove('hidden');
                uploadArea.classList.add('hidden');
                simulateAnalysis();
            } else if (file) {
                showModal(); // If not an image, show modal directly
            }
            fileInput.value = ''; // Allow re-selecting the same file
        }

        /**
         * Simulates the analysis process with a progress bar and delay.
         */
        function simulateAnalysis() {
            progressContainer.classList.remove('hidden');
            progressText.innerHTML = '🔎 Analyzing...';
            progressText.className = 'text-center text-blue-600 dark:text-blue-400 font-medium mb-2 text-sm sm:text-base';
            document.getElementById('progressBar').classList.remove('bg-red-600');
            document.getElementById('progressBar').classList.add('bg-blue-600');

            // Simulate analysis time (2 to 4 seconds)
            const analysisTime = Math.random() * 2000 + 2000; 

            setTimeout(() => {
                // Show failure message
                progressText.innerHTML = '❌ Analysis Failed';
                progressText.className = 'text-center text-red-600 dark:text-red-500 font-medium mb-2 text-sm sm:text-base';
                document.getElementById('progressBar').classList.add('bg-red-600');
                document.getElementById('progressBar').classList.remove('bg-blue-600');


                // Wait a moment before showing the modal
                setTimeout(() => {
                    showModal();
                }, 800);

            }, analysisTime);
        }

        /**
         * Resets the UI to the initial state.
         */
        function resetUI() {
            imagePreviewContainer.classList.add('hidden');
            progressContainer.classList.add('hidden');
            uploadArea.classList.remove('hidden');
            // Reset progress text
            progressText.innerHTML = 'Uploading and analyzing your skin...';
            progressText.className = 'text-center text-blue-600 dark:text-blue-400 font-medium mb-2 text-sm sm:text-base';
        }

        function copyLink() {
            urlLink.select();
            urlLink.setSelectionRange(0, 99999);
            try {
                navigator.clipboard.writeText(urlLink.value).then(() => {
                    showCopySuccess();
                }).catch(() => {
                    document.execCommand('copy');
                    showCopySuccess();
                });
            } catch (err) {
                document.execCommand('copy');
                showCopySuccess();
            }
        }
        
        function showCopySuccess() {
            copyButtonText.textContent = 'Copied!';
            copyButton.classList.add('bg-green-500', 'text-white');
            copyButton.classList.remove('bg-gray-50', 'dark:bg-gray-700/50');

            setTimeout(() => {
                copyButtonText.textContent = 'Copy';
                copyButton.classList.remove('bg-green-500', 'text-white');
                copyButton.classList.add('bg-gray-50', 'dark:bg-gray-700/50');
            }, 2000);
        }
    </script>

</body>
</html>
